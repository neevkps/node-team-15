<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ä—ñ—á</title>
    <link rel="stylesheet" href="/styles/ThingInformation.css">
</head>
<body>
<header><a href="/">üè† –ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞</a></header>

<main>
    <div id="information" class="info-box"></div>
</main>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get("id");

    fetch(`/thing/${id}?t=${Date.now()}`)
        .then(res => res.json())
        .then(data => {
            const result = document.getElementById('information');
            result.innerHTML = '';

            if (data) {
                const thing = data;
                const div = document.createElement('div');
                div.innerHTML = `
                    <h2>${thing.name}</h2>
                    <p><strong>–ú—ñ—Å—Ü–µ:</strong> ${thing.place}</p>
                    <p><strong>–û–ø–∏—Å:</strong> ${thing.description}</p>
                    <p><strong>–ö–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞:</strong> ${thing.keyWords}</p>
                    <div class="contact">
                        <p><strong>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ñ –¥–∞–Ω—ñ:</strong></p>
                        <p>${thing.User.name}</p>
                        <p>${thing.User.phoneNumber}</p>
                        <p>${thing.User.email}</p>
                    </div>
                    <div class="buttons">
                        <button id="update">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
                        <button id="delete">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                    </div>
                `;
                result.appendChild(div);

                document.getElementById("update").addEventListener("click", () => {
                    window.location.href = `updateThing.html?id=${thing.id}`;
                });

                document.getElementById("delete").addEventListener("click", (event) => {
                    event.preventDefault();
                    if (confirm("–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—é —Ä—ñ—á?")) {
                        fetch(`/things/${id}`, {
                            method: "DELETE"
                        })
                            .then(res => {
                                if (res.ok) {
                                    alert("–†—ñ—á —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–∞.");
                                    window.location.href = "/allThings.html";
                                } else {
                                    return res.json().then(data => {
                                        alert(data.alertMessage || "–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –≤–∏–¥–∞–ª–µ–Ω–Ω—è.");
                                    });
                                }
                            })
                            .catch(err => {
                                console.error("–ü–æ–º–∏–ª–∫–∞:", err);
                                alert("–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞.");
                            });
                    }
                });

            } else {
                result.textContent = '–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.';
            }
        })
        .catch(err => {
            console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Ç—É:', err);
            const result = document.getElementById('information');
            result.textContent = '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.';
        });
</script>
</body>
</html>
